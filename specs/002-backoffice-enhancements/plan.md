# Implementation Plan: Backoffice Enhancements

**Branch**: `002-backoffice-enhancements` | **Date**: 2025-11-25 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-backoffice-enhancements/spec.md`

## Summary

This feature adds comprehensive backoffice management capabilities to the Laravel Blog Engine:

1. **Media Library** - Centralized upload, organization, and management of images/documents with automatic size optimization
2. **Categories & Tags Management** - Dedicated Filament resources for hierarchical categories and flat tags with bulk operations
3. **User & Role Management** - Full user CRUD with role assignment via Filament Shield integration
4. **Theme Management** - Customizable branding settings (colors, logo, footer) stored in the Settings model
5. **Generative Engine Optimization (GEO)** - Automatic llms.txt generation and JSON-LD structured data for AI discoverability

## Technical Context

**Language/Version**: PHP 8.4 / Laravel 12
**Primary Dependencies**: Filament 4.x, Livewire 3, Spatie Laravel-Permission, Intervention Image
**Storage**: SQLite (development), MySQL/PostgreSQL (production), Laravel Storage (media files)
**Testing**: Pest v4 with Feature/Unit/Browser tests
**Target Platform**: Web application (Laravel + Livewire)
**Project Type**: Web monolith (single Laravel application)
**Performance Goals**: < 2s for management operations, 100+ media files without degradation
**Constraints**: All media sizes must be generated asynchronously, theme changes must cache-bust
**Scale/Scope**: Support 1000+ records per management page with pagination

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Test-First Development | ✅ COMPLIANT | Tests will be written before implementation for each Filament Resource |
| II. Laravel Conventions | ✅ COMPLIANT | Using Eloquent, Form Requests, named routes, config() helper |
| III. TALL Stack Compliance | ✅ COMPLIANT | Filament uses Livewire, Tailwind; blog frontend uses Volt |
| IV. Code Quality Gates | ✅ COMPLIANT | Pint, Larastan, Tests, Build will run before completion |
| V. Simplicity & YAGNI | ✅ COMPLIANT | Using existing packages (Filament, Spatie Permission) not reinventing |

**Technology Constraints**:
- ✅ Backend: Laravel 12.x
- ✅ Admin Panel: Filament 4.x (existing)
- ✅ Testing: Pest 4.x
- ✅ CSS: TailwindCSS 4.x
- ✅ Roles/Permissions: Spatie Laravel-Permission (existing)

## Project Structure

### Documentation (this feature)

```text
specs/002-backoffice-enhancements/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # Phase 0 research findings
├── data-model.md        # Phase 1 data model design
├── quickstart.md        # Phase 1 implementation quickstart
├── contracts/           # Phase 1 API contracts
│   └── filament-resources.md
├── checklists/
│   └── requirements.md  # Specification quality checklist
└── tasks.md             # Phase 2 task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
app/
├── Filament/
│   ├── Resources/
│   │   ├── PostResource.php       # Existing
│   │   ├── CategoryResource.php   # NEW
│   │   ├── TagResource.php        # NEW
│   │   ├── MediaResource.php      # NEW
│   │   ├── UserResource.php       # NEW
│   │   └── RoleResource.php       # NEW (via Shield or custom)
│   └── Pages/
│       ├── ThemeSettings.php      # NEW
│       └── GeoSettings.php        # NEW
├── Models/
│   ├── Category.php      # Existing - add posts count
│   ├── Tag.php           # Existing - add posts count
│   ├── Media.php         # Existing - enhance for library
│   ├── User.php          # Existing - add deactivation
│   └── Setting.php       # Existing - use for theme/GEO
├── Services/
│   ├── ImageService.php  # Existing - enhance
│   ├── LlmsTxtService.php    # NEW
│   └── JsonLdService.php     # NEW
├── Observers/
│   └── PostObserver.php  # Existing - add llms.txt regeneration
└── Policies/
    ├── CategoryPolicy.php    # NEW
    ├── TagPolicy.php         # NEW
    ├── MediaPolicy.php       # NEW
    └── UserPolicy.php        # NEW

routes/
└── web.php               # Add /llms.txt route

resources/views/
├── components/
│   └── layouts/
│       └── blog.blade.php    # Enhance with JSON-LD, theme variables
└── livewire/pages/           # Existing frontend pages

tests/
├── Feature/
│   ├── Filament/
│   │   ├── CategoryResourceTest.php  # NEW
│   │   ├── TagResourceTest.php       # NEW
│   │   ├── MediaResourceTest.php     # NEW
│   │   └── UserResourceTest.php      # NEW
│   └── GEO/
│       ├── LlmsTxtTest.php           # NEW
│       └── JsonLdTest.php            # NEW
└── Unit/
    └── Services/
        ├── LlmsTxtServiceTest.php    # NEW
        └── JsonLdServiceTest.php     # NEW
```

**Structure Decision**: Single Laravel monolith with Filament admin panel. All management interfaces are Filament Resources/Pages. GEO features integrate into existing frontend via Services and Blade components.

## Complexity Tracking

> No constitution violations detected. All complexity is justified by existing patterns in the codebase.

| Decision | Rationale |
|----------|-----------|
| Use existing Settings model for theme | Avoids new migration, follows existing pattern |
| Use Filament Pages for settings (not Resources) | Settings are singleton-like, not CRUD entities |
| Generate llms.txt on-demand with caching | Simpler than file-based, avoids sync issues |
| Store JSON-LD in Blade components | Standard Laravel approach, no runtime overhead |

## Implementation Phases

### Phase 1: Categories & Tags Resources (P1)
- CategoryResource with hierarchy support
- TagResource with bulk operations
- Tests for both resources
- Policies with proper permission checks

### Phase 2: Media Library (P1)
- MediaResource with grid/list view
- Upload with automatic size generation
- Usage tracking across posts
- Bulk delete for unused media

### Phase 3: User & Role Management (P1)
- UserResource with role assignment
- Shield integration or custom RoleResource
- User deactivation (soft status)
- Last admin protection

### Phase 4: Theme Management (P2)
- ThemeSettings Filament Page
- Color picker, logo/favicon upload
- Footer content configuration
- Reset to defaults functionality
- Frontend theme variable injection

### Phase 5: GEO Features (P2)
- LlmsTxtService for generation
- /llms.txt route with caching
- JsonLdService for structured data
- GeoSettings page for configuration
- PostObserver integration for auto-regeneration
